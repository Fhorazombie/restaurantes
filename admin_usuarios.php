<?php /*Incluye el header de la pagina*/ 
include("incl/header.php"); ?><?php 

/*consulta de base de datos a las tablas usuarios y usuarios_meta*/    
$consulta = "SELECT usuarios.id, usuarios.nombre, usuarios.a_paterno, usuarios.a_materno, usuarios.correo, usuarios.usuario, usuarios_meta.fecha, usuarios_meta.admin FROM usuarios INNER JOIN usuarios_meta ON usuarios.id=usuarios_meta.user_id ORDER BY id DESC";
/* Prepara la consulta con la variable $bd que sale de conexion.php*/    $q = $bd->prepare($consulta);
/* ejecuta la consulta */   $q->execute(); 
/* ordena las columas en un array alamcenados en una variable llamada $rs */    
$rs = $q->fetchAll();
/*Se genera un array para los meses y conseguir un formato de fecha mas entendible*/    $losmeses = ["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"]; ?>        <div class="app-content content">          <div class="content-wrapper">            <div class="content-header row">              <div class="content-header-left col-md-6 col-12 mb-2">                <h3 class="content-header-title">Lista de Usuarios</h3>                <div class="row breadcrumbs-top">                  <div class="breadcrumb-wrapper col-12">                    <ol class="breadcrumb">                      <li class="breadcrumb-item"><a href="index.html">Inicio</a>                      </li>                      <li class="breadcrumb-item"><a href="#">Usuarios</a>                      </li>                      <li class="breadcrumb-item active">Todos los usuarios                      </li>                    </ol>                  </div>                </div>              </div>            </div>            <div class="content-body"><!-- List Of All Patients -->    <section id="patients-list">        <div class="row">            <div class="col-12">                <div class="card">                    <div class="card-header">                        <div class="heading-elements">                            <a href="usuarios_admin" class="btn btn-danger round btn-sm"><i class="la la-plus font-small-2"></i>                                Agregar usuario</a>                        </div>                    </div>                    <div class="card-body collapse show">                        <div class="card-body card-dashboard">                        </div>                        <div class="table-responsive">                            <table class="table table-striped table-bordered patients-list">                                <thead>                                    <tr>                                        <th>Nombre</th>                                        <th>Apellido Paterno</th>                                        <th>Apellido Materno</th>                                        <th>Correo</th>                                        <th>Usuario</th>                                        <th>Fecha de creación</th>                                        <th>Tipo de usuario</th>                                        <th>Gestión</th>                                    </tr>                                </thead>                                <tbody>                                    <?php                                         /*ciclo for para mostrar los usuarios, cuenta cuantos elementos existen en el array de $rs*/                                        for($i = 0; $i< count($rs); $i++){                                            /*Se da formato a la fecha  */                                          $la_fecha_desde_bd  =  $rs[$i]["fecha"];                                            $fecha_correcta = date_create($la_fecha_desde_bd);                                            $dia_mes = date_format( $fecha_correcta  , "d" );                                            $mes_numerico = date_format( $fecha_correcta  , "n" );                                            $anio_actual = date_format( $fecha_correcta  , "Y" );                                     ?>                                        <tr>                                            <td><?php echo $rs[$i]["nombre"] ?></td>                                            <td><?php echo $rs[$i]["a_paterno"] ?></td>                                            <td><?php echo $rs[$i]["a_materno"] ?></td>                                            <td><?php echo $rs[$i]["correo"] ?></td>                                            <td><?php echo $rs[$i]["usuario"] ?></td>                                            <td><?php                                                                                                 echo $dia_mes ."-" . $losmeses[$mes_numerico-1] . "-" . $anio_actual; ?>                                                                                            </td>                                            <td><?php                                                 if($rs[$i]["admin"] == 0) echo "Usuario nomal"; else echo "Administrador";                                             ?></td>                                            <td>                                                <a href="../usuarios_admin/?id=<?php echo $rs[$i]["id"];?>"><i class="ft-edit text-success"></i></a>                                                                                                <button type="button" type="button" class="dropdown-item btn btn-outline-danger" data-toggle="modal" data-target="#usuario_<?php echo $rs[$i]["id"] ?>" style="display: contents;">                                                    <i class="ft-trash-2 ml-1 text-warning"></i>                                                </button>                                                <div class="modal fade text-left" id="usuario_<?php echo $rs[$i]["id"] ?>" tabindex="-1" role="dialog" aria-labelledby="myModalLabel33" aria-hidden="true">                                        <div class="modal-dialog" role="document">                                            <div class="modal-content">                                                <div class="modal-header">                                                    <!-- Para borrar un usuario son dos pasos -->                                                    <h1 class="modal-title" id="myModalLabel27">Borrar Usuario</h1>                                                    <!-- Mediante un modal se pregunta si esta seguro de borrar ese usuario -->                                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">                                                      <span aria-hidden="true">&times;</span>                                                    </button>                                                </div>                                                <!-- Si le da en eliminar se manda a borrar_usuario.php que lo elimina de la base de datos -->                                                <form action="../incl/borrar_usuario.php" method="POST">                                                  <div class="modal-body">                                                    <h1 class="modal-title" id="myModalLabel27">¿Seguro que quieres borrar al usuario <?php echo $rs[$i]["usuario"]; ?>?</h1>                                                    <br>                                                    <input type="hidden" name="id" id="id" value="<?php echo $rs[$i]["id"] ?>">                                                  </div>                                                  <div class="modal-footer">                                                    <input type="reset" class="btn btn-outline-secondary btn-lg btn-info" data-dismiss="modal" value="Cerrar">                                                    <input type="submit" class="btn btn-outline-primary btn-lg btn-danger" value="Eliminar">                                                  </div>                                                </form>                                            </div>                                        </div>                                    </div>                                            </td>                                        </tr>                                    <?php } ?>                                </tbody>                                <tfoot>                                    <tr>                                        <th>Nombre</th>                                        <th>Apellido Paterno</th>                                        <th>Apellido Materno</th>                                        <th>Correo</th>                                        <th>Usuario</th>                                        <th>Fecha de creación</th>                                        <th>Tipo de usuario</th>                                        <th>Gestión</th>                                    </tr>                                </tfoot>                            </table>                        </div>                    </div>                </div>            </div>        </div>    </section>            </div>          </div>        </div>    <!-- ////////////////////////////////////////////////////////////////////////////--><?php include("incl/footer.php"); ?>